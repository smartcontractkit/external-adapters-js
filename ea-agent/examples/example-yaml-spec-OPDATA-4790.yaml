adapter_name: xusd-usd-exchange-rate
adapter_type: source
description: External Adapter for fetching the round value from the XUSD contract on Ethereum for XUSD-USD exchange rate (Customer = Stream)

# No hardcoded base_url - node operators provide their own RPC endpoint via environment variable

data_source_authentication:
  type: none

contract_details:
  # Default values shown for reference - actual values come from input parameters
  default_address: '0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94'
  default_function_selector: '0x146ca531'
  network: ethereum-mainnet
  chain_id: 1
  etherscan_url: https://etherscan.io/address/0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94#code

data_source_endpoints:
  - name: round
    method: POST
    path: /
    description: Fetches the round value from the XUSD contract via eth_call JSON-RPC
    parameters:
      required:
        - name: contractAddress
          type: string
          description: The Ethereum contract address to call
          example: '0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94'
        - name: functionSelector
          type: string
          description: The 4-byte function selector (keccak256 hash of function signature)
          example: '0x146ca531'
      optional: []
    headers:
      - key: Content-Type
        value: application/json
    request_body:
      jsonrpc: '2.0'
      method: eth_call
      params:
        - to: '{contractAddress}' # from input parameter
          data: '{functionSelector}' # from input parameter
        - latest
      id: 1
    timeout_ms: 10000
    rate_limit:
      requests_per_second: 0
      burst_size: 0
    endpoint_tested: true
    sample_response: |
      {
        "jsonrpc": "2.0",
        "id": 1,
        "result": "0x0000000000000000000000000000000000000000000000000000000000000121"
      }
    response_mapping:
      result_field: result
      result_type: uint256
      conversion: hex_to_decimal
    data_freshness:
      timestamp_field: ''
      max_age_seconds: 0

external_adapter_specifications:
  environment_variables:
    - name: ETHEREUM_RPC_URL
      description: Ethereum JSON-RPC endpoint URL provided by the node operator
      required: true
      example: https://mainnet.infura.io/v3/YOUR_PROJECT_ID
  endpoints:
    - name: round
      description: Fetches the round value from the XUSD contract
      input_parameters:
        - name: contractAddress
          type: string
          description: The Ethereum contract address to call
          required: true
          example: '0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94'
        - name: functionSelector
          type: string
          description: The 4-byte function selector for the contract function to call
          required: true
          example: '0x146ca531'
      contract_function:
        name: round
        signature: 'function round() public view returns (uint256)'
        default_selector: '0x146ca531'
  endpoint_request_response_examples:
    - endpoint: round
      request: |
        {
          "data": {
            "endpoint": "round",
            "contractAddress": "0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94",
            "functionSelector": "0x146ca531"
          }
        }
      response: |
        {
          "statusCode": 200,
          "result": 289
        }
      curl_example: |
        curl -s -X POST $ETHEREUM_RPC_URL \
          -H "Content-Type: application/json" \
          -d '{
            "jsonrpc": "2.0",
            "method": "eth_call",
            "params": [{
              "to": "0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94",
              "data": "0x146ca531"
            }, "latest"],
            "id": 1
          }'

data_source:
  provider_name: Node Operator Ethereum RPC
  type: on_chain_contract
  api_documentation_url: https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_call
  api_base_documentation: 'Ethereum JSON-RPC eth_call method'
  contract_source: https://etherscan.io/address/0xE2Fc85BfB48C4cF147921fBE110cf92Ef9f26F94#code
  support_contact: ''

metadata:
  business_owner: '[Nora McGlynn](/people/6201d0845d18ad007298fbf0)'
  technical_owner: Wilson Chen
  jira_ticket: OPDATA-4790
  deployment_chains:
    - ethereum-mainnet
