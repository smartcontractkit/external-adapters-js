import { MockWebsocketServer } from '@chainlink/external-adapter-framework/util/testing-utils'

export const mockWebSocketServer = (URL: string): MockWebsocketServer => {
  const mockWsServer = new MockWebsocketServer(URL + '/api/v1/ws', { mock: false })
  mockWsServer.on('connection', (socket) => {
    // Add delay otherwise the message may be sent before connection is established
    setTimeout(() => {
      socket.send(
        JSON.stringify({
          report: {
            feedID: '0x0003',
            fullReport:
              '0x00094baebfda9b87680d8e59aa20a3e565126640ee7caeab3cd965e5568b17ee00000000000000000000000000000000000000000000000000000000011cf889000000000000000000000000000000000000000000000000000000040000000100000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012000039d9e45394f473ab1f050a1b963e6b05351e52d71e507509ada0c95ed75b80000000000000000000000000000000000000000000000000000000068e8078d0000000000000000000000000000000000000000000000000000000068e8078d000000000000000000000000000000000000000000000000000043558e4712b100000000000000000000000000000000000000000000000000342bbf6c72570000000000000000000000000000000000000000000000000000000000690f948d00000000000000000000000000000000000000000000199cb834cf57ffdf088000000000000000000000000000000000000000000000199c7e7bda4eec36220000000000000000000000000000000000000000000000199cd928848eb967e880000000000000000000000000000000000000000000000000000000000000000639bc9e08ee2b405731a2aaf8e4849c7da16c1c6e150252e93bea9643fc12df39fba87d30ca0b8227e56fa4b28884510f9f3117e7d76b716965d273102b07651cf1541259a267118e0bd48611adfa57fc8a3b1e465ebe0e38ed6337deb764bca42884e0fb01f66ee9cb198fc6f85a63b34f1d65eb460c3b8f6847f11231677d6b8551b69b16b3ba635c1159a39c1b8b4fa4cd19843c2bc7b8663e3c77106127effa776ade295637851f7d0b616ca6f6f43520b5ee7072a1b0fe461e7312a842b600000000000000000000000000000000000000000000000000000000000000066536f0144f5cae7416977c93e57d1e46bb089bf28f20b9e2ba41fc0f4cfa3d7e19ff930fd47e7a94007dd89da63f8f5bc7dd8261dcbe4722e5fb17cd46d8b53d51ed3a56d7527712ecc6bbae15c4d9a7d20e0bce87c8211459d77034c1a75e350e4ecb20e17ae4fe4dbe0490a2d4df638ba621a3f2785ebdff4c7e3846e346d536a24e1da16b83d51e79b05611e539a2a136317af356418a00641c40610b33b84bd533eb46f9186b1d6283db8e924a43cfaa4a4e82407c96102d0707f098741a',
          },
        }),
      )
      socket.send(
        JSON.stringify({
          report: {
            feedID: '0x0008',
            fullReport:
              '0x00094baebfda9b87680d8e59aa20a3e565126640ee7caeab3cd965e5568b17ee00000000000000000000000000000000000000000000000000000000011cf8cd000000000000000000000000000000000000000000000000000000040000000100000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000300000000010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001200008707410e2c111fb0e80cab2fa004b215eea2d95b106e700243f9ebcc8fbd90000000000000000000000000000000000000000000000000000000068e807bb0000000000000000000000000000000000000000000000000000000068e807bb000000000000000000000000000000000000000000000000000043491896d897000000000000000000000000000000000000000000000000003428a469177f8700000000000000000000000000000000000000000000000000000000690f94bb000000000000000000000000000000000000000000000000186ce8239a1b48800000000000000000000000000000000000000000000000210ab84726b037800000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006cb0e76f0859dbe0b25b771a7ba589daf44a1bd948041954edacd4f68f2d81f82a5a5026d2a495d52997e9ad83255a156b7b1d3878706b08e96e3854ec09ba8c28e21f2d82b8d8067e5601033744600cc557201b31f69a8fe197d995f611599969e157994d8a9cac829a7e1fd37e30ed169bb42d91af3718bcbfc0d675c027557a2ecb34978a5baee4b3b122e3a8d6feebfbee8af59f7ddf3049927079d0d217804a1dfcd89b6bfae14923fdf36a2edd6c1205d45f9688ec5edccd0ea47c1c6e500000000000000000000000000000000000000000000000000000000000000062637cd4de8557cb0f40fd0f22db6ec5b1bb82d55ab8bcfe4e663df5c6a7f2806475cac29d1050f1142334f358a6b7f444091a3f8af24b10c6c15ef2e71c83ae857ca5b99cbe9af336da21ca7cbfef1da76ed141090783ec5ea2b06d397e2aa8f1d8653b634e9f2e820131034cc6bb84eb63922eea1aea60945f535a0fa850ba238c3ad195a209405d9c84fd73b7de63e16510efffc63e356e046e6ff658692974e1201be86ae3a06492d1af321d1d9a6d77742e2f607351ff14681b0aae2da58',
          },
        }),
      )
    }, 100)
  })

  return mockWsServer
}
