# This action acts as a signal dispatcher that fires whenever the release process has
# successfully completed. The listening workflow within the infra-k8s repository has
# a corresponding event handler to generate releases based on this signal

on:
  workflow_run:
    workflows: [Release]
    types: [completed]
    branches: [develop]
  workflow_dispatch:
    inputs:
      workflowRunId:
        description: The workflow_run.id of the release workflow that has published artifacts
        required: true
  push:
    branches:
      - fix/release-fix-fw

jobs:
  on-success:
    runs-on: ubuntu-latest
    steps:
      - id: test-consume-release
        name: 'Trigger Image Dispatcher'
        run: |
          whoami
          git config --list
          gh workflow run --repo smartcontractkit/infra-k8s image-dispatcher.yaml -F imageRepos="${{ steps.get-artifacts.outputs.result }}" -F gitRepo=${{ github.event.repository.name }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
